import numpy as np
from ase.atoms import Atoms
from pesexp.optimizers import RFO


def test_calc_shift_parameter_baker09_1():
    """Previously failed run (in baker system 09)"""
    opt = RFO(Atoms())
    mu = 0
    f_trans = np.array(
        [
            3.68775770e-11,
            1.05375341e-10,
            -1.20748881e-01,
            5.48624614e-01,
            5.92905657e-11,
            5.38204980e-12,
            -7.99705331e-01,
            4.59421296e-10,
            -4.45934288e-01,
            8.73219017e-01,
            -2.51387251e-09,
            8.13179569e-01,
            -1.17214343e00,
            -6.67969207e-10,
            -3.29227128e-01,
            -9.15673770e-10,
            6.10238387e-01,
            -2.16298396e-09,
            -5.62462279e00,
            2.76142805e00,
            -2.53603641e-10,
            -7.57262198e-10,
            5.22090598e-11,
            2.16793822e-01,
            9.75830491e-11,
            5.40589951e00,
            -1.29761317e-10,
            -1.21735665e00,
            6.59374740e-11,
            -2.79901419e-10,
            2.04419038e00,
            4.13824959e-11,
            1.73426477e00,
            3.93522512e-11,
            1.35274923e00,
            -2.53813335e-10,
            -2.54335590e00,
            -2.57989576e00,
            6.15056456e-11,
            -3.23049102e-02,
            -3.45327705e-11,
        ]
    )
    omega = np.array(
        [
            -1.38915854e-01,
            6.41664043e-01,
            1.31719956e00,
            1.97945483e00,
            2.90270581e00,
            3.12529275e00,
            3.20574159e00,
            3.57539033e00,
            3.88147744e00,
            4.66006282e00,
            4.80687342e00,
            5.76611164e00,
            6.81946006e00,
            7.15672276e00,
            8.06881342e00,
            8.44245196e00,
            8.97604510e00,
            1.03322897e01,
            1.09667840e01,
            1.37992786e01,
            1.45515217e01,
            1.57474795e01,
            1.64242099e01,
            1.83299578e01,
            1.92985090e01,
            2.47407212e01,
            2.78104878e01,
            2.90883245e01,
            3.11896977e01,
            3.85245278e01,
            4.54799314e01,
            5.36886388e01,
            7.00415987e01,
            7.37464558e01,
            7.58371867e01,
            9.79243588e01,
            1.02943997e02,
            1.03495540e02,
            1.07533774e02,
            1.25473638e02,
            1.41082404e02,
        ]
    )
    shift = opt.calc_shift_parameter(f_trans, omega, mu)
    ref = -4.28947
    assert abs(shift - ref) < 1e-5


def test_calc_shift_parameter_baker09_2():
    """Previously failed run (in baker system 09)"""
    opt = RFO(Atoms())
    mu = 0
    f_trans = np.array(
        [
            -4.98587374e-09,
            6.83299550e-09,
            7.25540051e-02,
            -1.89599173e-01,
            -5.61167802e-10,
            -2.86372902e-09,
            -7.47304780e-02,
            -1.45636319e-09,
            3.52321996e-02,
            5.02186719e-09,
            4.50223568e-02,
            -1.12921385e-01,
            -1.69593634e-01,
            -1.63503922e-09,
            -1.02615733e-01,
            -9.29002497e-02,
            -2.76625404e-09,
            9.20788230e-02,
            -2.61009260e-09,
            1.39931439e-02,
            9.81943066e-11,
            8.32911149e-10,
            6.79629396e-10,
            -1.72235021e-01,
            -1.60213407e-09,
            5.72039240e-01,
            3.02099420e-09,
            -1.32015807e-01,
            -2.49875927e-09,
            -5.49100653e-09,
            3.88177504e-01,
            7.27099999e-10,
            -7.24221033e-01,
            4.33696182e-09,
            7.00488683e-02,
            -7.62774602e-09,
            9.43431236e-01,
            -3.96126164e-01,
            1.27254789e-09,
            -3.88577751e-01,
            8.79305157e-09,
        ]
    )
    omega = np.array(
        [
            -1.38915854e-01,
            6.41664043e-01,
            1.36585225e00,
            1.90058734e00,
            2.90270581e00,
            3.12529275e00,
            3.32022109e00,
            3.57539033e00,
            3.91895067e00,
            4.80687342e00,
            5.01908700e00,
            5.76908283e00,
            6.06934852e00,
            7.15672276e00,
            7.82720138e00,
            8.41041299e00,
            8.44245196e00,
            9.44290024e00,
            1.03322897e01,
            1.38927234e01,
            1.45515217e01,
            1.57474795e01,
            1.64242099e01,
            1.83551908e01,
            1.92985090e01,
            2.30249538e01,
            2.78104878e01,
            2.91819558e01,
            3.11896977e01,
            3.85245278e01,
            4.59225138e01,
            5.36886388e01,
            6.97777838e01,
            7.37464558e01,
            7.57251962e01,
            9.79243588e01,
            1.02584034e02,
            1.03632558e02,
            1.07533774e02,
            1.25240083e02,
            1.41082404e02,
        ]
    )
    shift = opt.calc_shift_parameter(f_trans, omega, mu)
    ref = -0.138916
    assert abs(shift - ref) < 1e-5


def test_calc_shift_parameter_baker10_1():
    """Previously failed run (in baker system 10)"""
    opt = RFO(Atoms())
    mu = 1
    f_trans = np.array([-1.76696862e-13])
    omega = np.array([0.72761467])
    shift = opt.calc_shift_parameter(f_trans, omega, mu)
    ref = 0.72761
    assert abs(shift - ref) < 1e-5


def test_calc_shift_parameter_baker10_2():
    """Previously failed run (in baker system 10)"""
    opt = RFO(Atoms())
    mu = 1
    f_trans = np.array([1.03235612e-08])
    omega = np.array([0.72736632])
    shift = opt.calc_shift_parameter(f_trans, omega, mu)
    ref = 0.72737
    assert abs(shift - ref) < 1e-5
